"use strict";function _possibleConstructorReturn(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _get=function t(i,e,s){null===i&&(i=Function.prototype);var h=Object.getOwnPropertyDescriptor(i,e);if(void 0===h){var a=Object.getPrototypeOf(i);return null===a?void 0:t(a,e,s)}if("value"in h)return h.value;var n=h.get;if(void 0!==n)return n.call(s)},_createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),SoundFX=function(){function t(){return 1}function i(i,h,a,n,o,r){function l(){u.frequency.value=i+h*g,d.gain.value=(1-g/n)*o*t(),g++,g>n&&(clearInterval(p),setTimeout(c,a+n))}function c(){u.stop()}var u=e.createOscillator();u.frequency.value=i,u.type=s[r||0];var d=e.createGain();d.gain.value=0,u.connect(d),d.connect(e.destination),u.start();var g=0,p=setInterval(l,a)}var e=new(window.AudioContext||window.webkitAudioContext),s=["square","sawtooth","triangle","sine"];return{playSound:i,fart:function(){i(50,50,10,10,1,1)},jump:function(){i(150,30,15,20,.5)},pew:function(){i(920,-80,20,15,.5)},zap:function(){i(500,-200,40,10,.25,1)},bounce:function(){i(260,-60,15,15,.5,2)},tap:function(){i(150,10,10,10,.5,3)},splash:function(){i(120,-6,20,15,.1,1),i(40,-2,20,25,1,2),i(60,10,15,15,.1,1),i(160,-5,20,30,.1,3)},die:function(){i(160,10,15,10,.1),i(250,-20,30,10,.1,1),i(1500,-150,30,10,.1,1)},coin:function(){i(510,0,15,20,.05)}}}();window.$={},$.cols={black:"#000",ash:"#9d9d9d",blind:"#fff",bloodred:"#be2633",pigmeat:"#e06f8b",oldpoop:"#493C2B",newpoop:"#a46422",blaze:"#eb8931",zornskin:"#f7e26b",shadegreen:"#2f484e",leafgreen:"#44891A",slimegreen:"#A3CE27",nightblue:"#1B2632",seablue:"#005784",skyblue:"#31A2F2",cloudblue:"#B2DCEF"},window.addEventListener("load",function(){new Game},!1),$.data={version:"0.1",title:"Poopy River",orientation:"portrait",audio:!0},$.data.i={boom:"R0lGODlhCAAIAMIEAL4mM+uJMffia////zGi8jGi8jGi8jGi8iH5BAEKAAMALAAAAAAIAAgAAAMNOAMMuo3BSKu9s72oEgA7",bun:"R0lGODlhCAAIAMIEAL4mM+Bvi+uJMffiazGi8jGi8jGi8jGi8iH5BAEKAAQALAAAAAAIAAgAAAMUSAqgGjC+CAm9OBAxOFdeN4DilwAAOw==",cherry:"R0lGODlhCAAIAKEDAL4mM0SJGuBvizGi8iH5BAEKAAMALAAAAAAIAAgAAAISnBd5yBcGgBtARCqjtrnf9R0FADs=",circle:"R0lGODlhCAAIAIABAAAAADGi8iH5BAEKAAEALAAAAAAIAAgAAAIMTIBgl8gNo5wvrWYKADs=",dude:"R0lGODlhCAAIAMIEAEk8K6RkIuuJMffiazGi8jGi8jGi8jGi8iH5BAEKAAQALAAAAAAIAAgAAAMWSAqgC0OwNaIkLIxwcRUdZDXP5GBnAgA7",dude0:"R0lGODlhCAAIAMIEAEk8K6RkIuuJMffiazGi8jGi8jGi8jGi8iH5BAEKAAQALAAAAAAIAAgAAAMWSAqgC0OwNaIkLIxwcRUdZDXP5GBnAgA7",dude1:"R0lGODlhCAAIAMIEAEk8K6RkIuuJMffiazGi8jGi8jGi8jGi8iH5BAEKAAQALAAAAAAIAAgAAAMVSAqgC0OwNaKkQYQJbSOdcD2T43wJADs=",dudejump:"R0lGODlhCAAIAMIFAEk8K6RkIuBvi+uJMffiazGi8jGi8jGi8iH5BAEKAAcALAAAAAAIAAgAAAMXeAqgC2SwRaI8LMQwoRAXVg0hxjQOiiYAOw==",font:"R0lGODlhjwAFAIABAAAAAP///yH5BAEKAAEALAAAAACPAAUAAAJzDGKHcLzOFDRJ0UbXzdJ2lFQbRo5ipJ1TA7XsW2KanNWyZXpuzuNSz5txQDZTChSrsI6kXfOHDNmcl9+LKXxiU7fHBwV2zFxJzwZbGiazq+kyqua2h0I6vEhLh977Dm1fBaW1BvUwYmYY16UiuDN29VhRAAA7",land:"R0lGODlhCAAIAKEDAESJGvfia////zGi8iH5BAEKAAMALAAAAAAIAAgAAAINhB9yqAvpXlvQVTpZAQA7",melon:"R0lGODlhCAAIAMIEAAAAAL4mM0SJGv///zGi8jGi8jGi8jGi8iH5BAEKAAQALAAAAAAIAAgAAAMWSLo68XA4AIOs9NIoHBedNIAEaApEAgA7",orange:"R0lGODlhCAAIAMIFAL4mM0SJGuuJMaPOJ/fiazGi8jGi8jGi8iH5BAEKAAcALAAAAAAIAAgAAAMVeLosAiGMQ5wL1Dpw9O4eB34LYC4JADs=",ouch:"R0lGODlhCAAIAIABAKRkIjGi8iH5BAEKAAEALAAAAAAIAAgAAAIMTIBgl8gNo5wvrWYKADs=",ouch2:"R0lGODlhCAAIAIABAEk8KzGi8iH5BAEKAAEALAAAAAAIAAgAAAIMTIBgl8gNo5wvrWYKADs=",poop0:"R0lGODlhCAAIAKECAEk8K6RkIjGi8jGi8iH5BAEKAAIALAAAAAAIAAgAAAIPlAVnwHntRAhsLpiwxogXADs=",poop1:"R0lGODlhCAAIAKECAEk8K+uJMTGi8jGi8iH5BAEKAAIALAAAAAAIAAgAAAIPlAVnwHntRAhsLpiwxogXADs=",ripple:"R0lGODlhCAAIAIAAADGi8jGi8iH5BAEKAAEALAAAAAAIAAgAAAIPTIBgt6x9XkMwViWZSa8AADs=",shadow:"R0lGODlhCAAIAIABAAAAADGi8iH5BAEKAAEALAAAAAAIAAgAAAIMTIBgl8gNo5wvrWYKADs="},$.data.sfx={},$.H={listen:function(t,i){window.addEventListener(t,i,!1)},el:function(t){return document.getElementById(t)},rnd:function(t,i){return Math.floor(Math.random()*(i-t+1)+t)},rndArray:function(t){return t[~~(Math.random()*t.length)]},textWidth:function(t,i){return t.length*(3*i.scale)+t.length*(1*i.scale)},timeStamp:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},tween:function(t,i,e,s){return e*t/s+i},mkFavicon:function(t){var i=document.createElement("canvas");i.width=32,i.height=32;var e=i.getContext("2d");e.drawImage(t,0,0);var s=document.createElement("link");s.type="image/x-icon",s.rel="shortcut icon",s.href=i.toDataURL("image/x-icon"),document.getElementsByTagName("head")[0].appendChild(s)},mkCanvas:function(t,i){var e=document.createElement("canvas"),s=e.getContext("2d");return e.width=t,e.height=i,s.mozImageSmoothingEnabled=!1,s.msImageSmoothingEnabled=!1,s.imageSmoothingEnabled=!1,e},resize:function(t,i,e){i=i||1,e=e||!1;var s=t.width*i,h=t.height*i,a=document.createElement("canvas");a.width=t.width,a.height=t.height;var n=a.getContext("2d");n.drawImage(t,0,0);var o=n.getImageData(0,0,t.width,t.height),r=document.createElement("canvas");r.width=s,r.height=h;var l,c,u=r.getContext("2d"),d=u.getImageData(0,0,s,h);for(l=0;l<h;l++)for(c=0;c<s;c++){var g=4*(Math.floor(l/i)*t.width+Math.floor(c/i)),p=4*(l*s+c);d.data[p]=o.data[g],d.data[p+1]=o.data[g+1],d.data[p+2]=o.data[g+2],d.data[p+3]=o.data[g+3],0===o.data[g+3]?(d.data[p]=0,d.data[p+1]=0,d.data[p+2]=0,d.data[p+3]=0):e&&(d.data[p]=e[0],d.data[p+1]=e[1],d.data[p+2]=e[2],d.data[p+3]=255)}u.putImageData(d,0,0);var A=new Image;return A.src=r.toDataURL("image/png"),A}};var Load=function(){function t(i){_classCallCheck(this,t),this.g=i,this.imgsLoaded=0,this.imgsTotal=Object.keys($.data.i).length,this.loadImages()}return _createClass(t,[{key:"loadImages",value:function(){var t,i=this.g,e="data:image/gif;base64,",s=$.data.i;for(t in s)s.hasOwnProperty(t)&&(i.imgs[t]=new Image,i.imgs[t].onload=this.checkLoaded(),i.imgs[t].src=e+s[t])}},{key:"checkLoaded",value:function(){var t=this,i=(this.g,this);this.imgsLoaded+=1,i.imgsLoaded===i.imgsTotal&&window.setTimeout(function(){return t.mkFonts()},100)}},{key:"mkFonts",value:function(){var t=this.g,i={b:[0,0,0],w:[255,255,255],g:[163,206,39],r:[190,38,51],y:[247,226,107],o:[235,137,49],op:[73,60,43],np:[164,100,34],p:[224,111,139]},e=t.imgs,s=void 0;for(s in i)t.fonts[s]=$.H.resize(t.imgs.font,1,i[s]);for(s in e)e[s+"_w"]=$.H.resize(e[s],1,[255,255,255]);window.setTimeout(function(){t.init()},250)}}]),t}();$.Audio={init:function(){},play:function(t){$.data.audio&&SoundFX[t]()},say:function(){$.data.audio}};var Game=function(){function t(){_classCallCheck(this,t);var i=navigator.userAgent.toLowerCase(),e=void 0,s=void 0;this.l=document.getElementById("l"),this.h=document.getElementById("h"),"portrait"===$.data.orientation?(e=320,s=480):(e=480,s=320),this.c=document.getElementsByTagName("canvas")[0],this.ctx=this.c.getContext("2d"),this.w=e,this.h=s,this.c.width=e,this.c.height=s,this.c.style.width=e+"px",this.c.style.height=s+"px",this.dt=0,this.fps=30,this.frameStep=1/this.fps,this.frameCurr=0,this.framePrev=$.H.timeStamp(),this.mobile="createTouch"in document||!1,this.android=i.indexOf("android")>-1,this.ios=/ipad|iphone|ipod/.test(i),this.firefox=i.indexOf("firefox")>-1,this.restrict=!(!this.firefox&&!this.ios),this.restrict=!1,this.plays=0,this.events=[],this.ents=[],this.imgs=[],this.fonts=[],this.sfx=[],document.title=$.data.title,this.load()}return _createClass(t,[{key:"load",value:function(){this.draw=new Draw(this.ctx,this.w,this.h),this.input=new Input(this),this.emitter=new Emitter(this),this.shake=new Shake(this),!$.data.audio||this.mobile&&this.firefox||this.ios?this.audio={play:function(){},say:function(){}}:(this.audio=$.Audio,this.audio.init()),this.load=new Load(this)}},{key:"init",value:function(){var t=this;this.scale(),$.H.mkFavicon(this.draw.scale(this.imgs.dudejump,4)),this.changeState("Title"),"undefined"!=typeof Stats&&window.location.search.indexOf("stats")!==-1?(this.stats=new Stats,this.stats.showPanel(0),document.body.appendChild(this.stats.dom)):this.stats={begin:function(){},end:function(){}},this.loop(),window.addEventListener("resize",function(){return t.scale()},!1)}},{key:"loop",value:function(){var t=this;for(this.stats.begin(),this.frameCurr=$.H.timeStamp(),this.dt=this.dt+Math.min(1,(this.frameCurr-this.framePrev)/1e3),this.c.className="",this.input.poll();this.dt>this.frameStep;)this.dt=this.dt-this.frameStep,this.state.update(this.frameStep);this.shake.update(this.dt),this.state.render(this.dt),this.framePrev=this.frameCurr,this.stats.end(),requestAnimationFrame(function(){return t.loop()})}},{key:"update",value:function(t){var i=!0,e=!1,s=void 0;try{for(var h,a=this.ents[Symbol.iterator]();!(i=(h=a.next()).done);i=!0){var n=h.value;console.log("ok"),n.update(t)}}catch(o){e=!0,s=o}finally{try{!i&&a["return"]&&a["return"]()}finally{if(e)throw s}}}},{key:"render",value:function(){this.draw.clear(),this.draw.rect(100,100,100,100,"pink");var t=!0,i=!1,e=void 0;try{for(var s,h=this.ents[Symbol.iterator]();!(t=(s=h.next()).done);t=!0){var a=s.value;a.render()}}catch(n){i=!0,e=n}finally{try{!t&&h["return"]&&h["return"]()}finally{if(i)throw e}}}},{key:"scale",value:function(){"portrait"===$.data.orientation?this.scalePortrait():this.scaleLandscape()}},{key:"scalePortrait",value:function(){var t=window.innerHeight,i=this.w/this.h,e=t*i;e/this.w;this.mobile&&t<window.innerWidth?(this.l.style.display="block",$.H.el("h").innerHTML="Rotate Device",this.c.style.display="none"):(this.l.style.display="none",this.c.style.display="block"),1==window.navigator.standalone&&this.ios||(this.c.width=this.w,this.c.height=this.h,this.cx=this.w/2,this.cy=this.h/2,this.c.style.width=~~e+"px",this.c.style.height=~~t+"px")}},{key:"scaleLandscape",value:function(){}},{key:"changeState",value:function(t){switch(this.ents=[],this.events=[],t){case"Touch":this.state=new Touch(this);break;case"Title":this.state=new Title(this);break;case"Intro":this.state=new Intro(this);break;case"Splash":this.state=new Splash(this);break;case"Play":this.state=new Play(this)}}},{key:"mkFont",value:function(t,i){var e=this,s=e.draw.scale(e.fonts[t],i);return s.scale=i,s}},{key:"addEvent",value:function(t){this.events.push(t)}}]),t}(),State=function(){function t(i){_classCallCheck(this,t),this.g=i,this.init()}return _createClass(t,[{key:"init",value:function(){this.bgCol=!1,this.fader=0}},{key:"update",value:function(t){for(var i=this.g,e=i.ents.length;e--;)i.ents[e].update(t);for(e=i.ents.length;e--;)i.ents[e].remove&&i.ents.splice(e,1);for(e=i.events.length;e--;){var s=i.events[e];if(!s)break;s.time-=i.dt,s.time<0&&(s.cb.call(this),i.events.splice(e,1))}this.fader=Math.sin(.005*(new Date).getTime())}},{key:"render",value:function(){var t=this.g.ents.length;for(this.bgCol&&this.g.draw.clear(this.bgCol),t=0;t<this.g.ents.length;t+=1)this.g.ents[t].render()}}]),t}(),Input=function(){function t(i){var e=this;_classCallCheck(this,t);var s=window.addEventListener;this.g=i,this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.m={x:i.w/2,y:i.h/2,click:0},this.keys={up:0,down:0,left:0,right:0,shoot:0,enter:0},this.keyMappings={up:38,down:40,left:37,right:39,shoot:32,enter:13},s("keydown",function(t){return e.press(t,1)},!1),s("keyup",function(t){return e.press(t,0)},!1),s("mousemove",function(t){return e.trackMove(t)},!1),s("mousedown",function(t){return e.m.click=1},!1),s("mouseup",function(t){return e.m.click=0},!1),s("touchstart",function(t){e.m.click=1,e.trackMove(t.touches[0])},!1),s("touchend",function(t){e.m.click=0,e.trackMove(t.touches[0])},!1),s("touchmove",function(t){t.preventDefault(),e.trackMove(t.touches[0])},!1)}return _createClass(t,[{key:"poll",value:function(){}},{key:"press",value:function(t,i){for(var e in this.keyMappings)t.keyCode===this.keyMappings[e]&&(this.keys[e]=i)}},{key:"trackMove",value:function(t){var i=this.g,e=i.c.offsetTop,s=i.c.offsetLeft,h=parseInt(i.c.style.width,10)/i.c.width,a=~~((t.pageX-s)/h),n=~~((t.pageY-e)/h);a=a>i.w?i.w:a,a=a<0?0:a,n=n>i.h?i.h:n,n=n<0?0:n,this.m.x=~~a,this.m.y=~~n}}]),t}(),Draw=function(){function t(i,e,s){_classCallCheck(this,t),this.ctx=i,this.w=e,this.h=s}return _createClass(t,[{key:"clear",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"#000":arguments[0];this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.w,this.h)}},{key:"rect",value:function(t,i,e,s,h){this.ctx.fillStyle=h,this.ctx.fillRect(t,i,e,s)}},{key:"circle",value:function(t,i,e){this.ctx.beginPath(),this.ctx.fillStyle="#fff",this.ctx.arc(t,i,e,0,2*Math.PI),this.ctx.closePath()}},{key:"scale",value:function(t,i,e){var s=$.H.mkCanvas(t.width*i,t.height*i),h=s.getContext("2d");return s.width&&(h.save(),h.scale(i,i),h.drawImage(t,0,0),h.restore()),s}},{key:"flip",value:function(t,i,e){var s=$.H.mkCanvas(t.width,t.height),h=s.getContext("2d"),a=i?-1:1,n=e?-1:1,o=i?t.width*-1:0,r=e?t.height*-1:0;return s.width=t.width,s.height=t.height,h.save(),h.scale(a,n),h.drawImage(t,o,r,t.width,t.height),h.restore(),s}},{key:"text",value:function(t,i,e,s,h){var a=0,n=this.ctx,o=65,r=0,l=3*i.scale,c=5*i.scale,u=1*i.scale,d=$.H.textWidth(t,i),g=0;for("number"!=typeof t&&"0"!==t[0]||(t+="",r=43),e=e||(this.w-d)/2,h&&(this.text(t,h.f,e+h.offset,s),this.text(t,h.f,e-h.offset,s),this.text(t,h.f,e,s+h.offset),this.text(t,h.f,e,s-h.offset)),a=0;a<t.length;a+=1)g=(t.charCodeAt(a)-o+r)*(l+u),g>-1&&n.drawImage(i,g,0,l,c,~~e,~~s,l,c),e+=l+u}}]),t}(),Sprite=function(){function t(i){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,t),this.g=i,this.dead=!1,this.remove=!1,this.id=Date.now()+"-"+i.ents.length,this.angle=0,this.lastPos={x:this.x,y:this.y},this.flip={x:0,y:0},this.restrict=!0,this.scale=e.scale||1,this.frame=e.frame||1,this.frames=e.frames||1,this.frameRate=e.frameRate||80,this.frameNext=e.frameNext||0;for(var s in e)this[s]=e[s];this.o=e,e.i&&this.mkImg(e.i),this.bound=e.bound||{w:this.w,h:this.h,x:0,y:0},this.init()}return _createClass(t,[{key:"init",value:function(){this.anims={idle:{frames:[1],rate:80}},this.changeAnim("idle")}},{key:"update",value:function(t){this.lastPos.x=this.x,this.lastPos.y=this.y,this.collidesWith&&this.hitGroup(this.collidesWith),this.updateAnim(t),this.updateMove(t),this.restrict&&this.restrictToScreen(),this.gravity&&(this.vy+=this.gravity*this.g.dt)}},{key:"updateAnim",value:function(t){this.frameNext<0&&(this.frameNext=this.anim.rate,this.anim.counter+=1,this.anim.counter>=this.anim.frames.length&&(this.anim.next?this.changeAnim(this.anim.next):this.anim.counter=0),this.frame=this.anim.frames[this.anim.counter]),this.frameNext-=this.g.dt}},{key:"updateMove",value:function(t){}},{key:"restrictToScreen",value:function(){this.x<0&&(this.x=0),this.x>this.g.w-this.w&&(this.x=this.g.w-this.w),this.y<0&&(this.y=0),this.y>this.g.h-this.h&&(this.y=this.g.h-this.h)}},{key:"render",value:function(){var t=this.g,i=this.i,e=this.frame;i?(this.flip.y&&(i=t.draw.flip(i,0,1)),this.flip.x&&(i=t.draw.flip(i,1,0),e=this.frames-this.frame+1),t.ctx.drawImage(i,e*this.w-this.w,0,this.w,this.h,~~this.x,~~this.y,this.w,this.h)):this.g.draw.rect(~~this.x,~~this.y,this.w,this.h,this.col)}},{key:"doDamage",value:function(t){}},{key:"receiveDamage",value:function(t){}},{key:"kill",value:function(){this.dead=!0,this.remove=!0}},{key:"hitGroup",value:function(t){for(var i=this.g,e=i.ents.length;e--;)i.ents[e]&&i.ents[e].group===t&&i.ents[e].id!==this.id&&this.hit(i.ents[e])&&i.ents[e].dead===!1&&(this.doDamage(i.ents[e]),i.ents[e].receiveDamage(this))}},{key:"hit",value:function(t){return!(t.y+t.h<this.y||t.y>this.y+this.h||t.x+t.w<this.x||t.x>this.x+this.w)}},{key:"mkImg",value:function(t){var i=this.g;this.i=i.draw.scale(i.imgs[t],this.scale),this.w=this.i.width/this.frames,this.h=this.i.height,this.iHurt=i.draw.scale(i.imgs[t+"_w"],this.scale)}},{key:"changeAnim",value:function(t){this.anim&&this.anim.name&&this.anim.name===t||(this.anim=this.anims[t],this.anim.name=t,this.anim.counter=0,this.frame=this.anim.frames[0],this.frameNext=this.anim.rate)}},{key:"rotate",value:function(t,i){var e=document.createElement("canvas"),s=e.getContext("2d"),h=Math.max(t.width,t.height)+6;i*(180/Math.PI);return e.width=h,e.height=h,s.translate(h/2,h/2),s.rotate(i+Math.PI/2),s.drawImage(t,-(t.width/2),-(t.height/2)),e}}]),t}(),Particle=function(t){function i(t,e){_classCallCheck(this,i);var s=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,t,e));return s.name="particle",s.scale=1,s.group="na",s.w=4,s.h=4,s.lifespan=$.H.rnd(20,50),s.ttl=s.lifespan,s.alpha=1,s.vx=$.H.rnd(0,300)-300,s.vy=$.H.rnd(0,300)*-1,s}return _inherits(i,t),_createClass(i,[{key:"update",value:function(t){_get(Object.getPrototypeOf(i.prototype),"update",this).call(this,t),this.x+=this.vx*t,this.y+=this.vy*t,this.ttl-=1,this.ttl<0&&(this.remove=!0)}},{key:"render",value:function(){var t=this.g;t.ctx.globalAlpha=this.ttl/this.lifespan,t.draw.rect(this.x,this.y,5,5,$.cols[this.col]),t.ctx.globalAlpha=1}}]),i}(Sprite),Emitter=function(){function t(i){_classCallCheck(this,t),this.g=i}return _createClass(t,[{key:"particle",value:function(t,i,e){var s=arguments.length<=3||void 0===arguments[3]?["ash"]:arguments[3],h=this.g,a=void 0;for(a=0;a<t;a+=1){var n=$.H.rndArray(s);h.ents.push(new Particle(h,{x:i,y:e,col:n}))}}},{key:"explosion",value:function(t,i,e,s,h){for(var a=this.g,n=$.H.rnd;t--;)window.setTimeout(function(){a.ents.push(new Explosion(a,{x:i+n(-10,10),y:e+n(-10,10),magnitude:h,particles:s}))},150*t)}}]),t}(),Shake=function(){function t(i){_classCallCheck(this,t),this.g=i,this.c=i.c,this.ttl=0,this.mag=0}return _createClass(t,[{key:"start",value:function(t,i){this.mag=t,this.ttl=i,this.l=(window.innerWidth-this.c.style.width)/2}},{key:"update",value:function(){var t=(this.g,this.c),i=$.H.rnd(-this.mag,this.mag);this.ttl-=1,0===this.ttl?(t.style.marginLeft=this.l+"px",t.style.marginTop="0px"):this.ttl>0&&(t.style.marginTop=i+"px",t.style.marginLeft=i+this.l+"px")}}]),t}(),Button=function(t){function i(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,i),e.size=e.size||4,e.w=e.w||150,e.h=e.h||50,e.delay=e.delay||100,e.col=e.col||$.cols.slimegreen,e.triggerOnEnter=e.triggerOnEnter||!1,e.fadeIn=e.fadeIn||0;var s=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,t,e));return s.p=t.mkFont("w",e.size),s.pHover=t.mkFont("b",e.size),s.boxX=~~(s.g.w/2-s.w/2),s.boxY=s.y-15,s.clicked=!1,s.clickCol=e.clickCol||"#fff",s.currentCol=s.col,s.clicked=!1,s.fontCol="p",s}return _inherits(i,t),_createClass(i,[{key:"update",value:function(){var t=this,i=this.g.input.m.click;this.fontCol="p",this.fadeIn-=1,this.hover=this.intersects(),this.hover&&(this.g.c.className="hover",this.fontCol="pHover"),this.currentCol=this.hover||this.hover&&i?this.clickCol:this.col,(!this.clicked&&this.hover&&i||!this.clicked&&this.triggerOnEnter&&this.g.input.keys.enter)&&(this.g.audio.play("tap"),this.clicked=!0,setTimeout(function(){t.cb.call()},this.delay))}},{key:"render",value:function(){var t=this.hover?this.pHover:this.p;this.g.draw.rect(this.boxX,this.boxY,this.w,this.h,this.currentCol),this.g.draw.text(this.text,t,this.x,this.y)}},{key:"intersects",value:function(){var t=this.g.input.m;return t.x>this.boxX&&t.x<this.boxX+this.w&&t.y>this.boxY&&t.y<this.boxY+this.h}}]),i}(Sprite),Map=function(){function t(i,e){_classCallCheck(this,t),this.g=i,this.p=e.p,this.tileSize=8,this.scale=4,this.f=this.g.mkFont("w",2),this.tileDim=this.tileSize*this.scale,this.tileX=this.g.w/this.tileDim,this.tileY=this.g.h/this.tileDim,this.w=i.w/(this.tileSize*this.scale),this.vx=0,this.vy=1,this.cx=0,this.cy=0;var s=i.draw.scale(i.imgs.land,this.scale),h=i.draw.flip(s,-1);for(this.tileSet=[!1,s,h,i.draw.scale(i.imgs.poop0,this.scale),i.draw.scale(i.imgs.cherry,this.scale),i.draw.scale(i.imgs.orange,this.scale),i.draw.scale(i.imgs.melon,this.scale)],this.poop0=i.draw.scale(i.imgs.poop0,this.scale),this.poop1=i.draw.scale(i.imgs.poop1,this.scale),this.data=[];this.data.length<=this.tileY/2;)this.data.push(this.newRow());for(;this.data.length<=this.tileY+6;)this.data.push(this.newRow(!0));this.data[this.data.length-2][5]=3,this.fish=this.p.fish}return _createClass(t,[{key:"newRow",value:function(){for(var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],i=[1],e=this.g.w/(this.tileSize*this.scale)-2,s=0;s<e;s++)i.push(t?0:Math.random()>.97?this.randomBlock():0);return i.push(2),i}},{key:"randomBlock",value:function(){return Math.random()>.33?3:$.H.rnd(4,6)}},{key:"update",value:function(t){this.cy+=~~(this.p.speed*t),this.cy>this.tileDim&&(this.data.shift(),this.data.push(this.newRow()),this.cy-=this.tileDim)}},{key:"render",value:function(){for(var t=0,i=this.cy,e=this.g,s=$.H.mkCanvas(e.w,e.h),h=s.getContext("2d"),a=this.g.h/(this.tileSize*this.scale),n=(this.cy,this.tileSet),o=this,r=this.p,l=this.tileDim,c=0;c<a;c+=1){var u=this.data[this.data.length-c-1];t=0,u.forEach(function(e){e&&(3==e?h.drawImage(r.fader>0?o.poop0:o.poop1,~~t,~~i):h.drawImage(n[e],~~t,~~i)),t+=l}),i+=l}e.ctx.drawImage(s,0,0)}},{key:"checkEnt",value:function(t){var i=Math.floor(t.x/this.tileDim),e=Math.floor(Math.floor(t.y/this.tileDim)-Math.floor(this.cy/this.tileDim));e=12;var s=this.data[this.data.length-e],h=s[i],a=s[i+1];return[h,a,[i,e]]}},{key:"checkCoords",value:function(t,i){t=Math.floor(t/this.tileDim),i=Math.floor(i/this.tileDim-this.cy/this.tileDim);var e=this.data[i];return e.toString().split(""),e[t]}}]),t}(),Title=function(t){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return _inherits(i,t),_createClass(i,[{key:"init",value:function(){var t=this;this.g.hiScore||(this.g.hiScore=20),this.bgCol=$.cols.oldpoop,this.title=this.g.mkFont("o",9),this.titleShadow=this.g.mkFont("o",9),this.hi=this.g.mkFont("w",3),this.sm=this.g.mkFont("w",2),this.g.audio.play("fart"),this.g.ents.push(new Button(this.g,{y:380,triggerOnEnter:!0,col:$.cols.newpoop,text:"PLAY",cb:function(){t.g.changeState("Play")}})),this.g.ents.push(new Button(this.g,{y:450,size:2,clickCol:"transparent",col:"transparent",text:"BY EOINMCG",cb:function(){window.location="//twitter.com/eoinmcg"}}))}},{key:"render",value:function(){this.g.draw.clear(this.bgCol),this.g.ctx.globalAlpha=.3,this.g.ctx.globalAlpha=1,this.g.draw.text("POOPY",this.title,!1,80,{f:this.titleShadow,offset:2}),this.g.draw.text("RIVER",this.title,!1,140,{f:this.titleShadow,offset:2});var t=!0,i=!1,e=void 0;try{for(var s,h=this.g.ents[Symbol.iterator]();!(t=(s=h.next()).done);t=!0){var a=s.value;a.render()}}catch(n){i=!0,e=n}finally{try{!t&&h["return"]&&h["return"]()}finally{if(i)throw e}}}}]),i}(State),Play=function(t){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return _inherits(i,t),_createClass(i,[{key:"init",value:function(){this.bgCol=!1,this.ripples=[],this.score=0,this.hiScore=parseInt(localStorage.getItem("hiScore"),10)||20,this.newHi=!1,this.h1=this.g.mkFont("o",7),this.timer=this.g.mkFont("w",8),this.p=this.g.mkFont("r",8),this.pw=this.g.mkFont("w",8),this.hi=this.g.mkFont("w",3),this.hi_s=this.g.mkFont("p",3),this.dude=new Dude(this.g,{p:this}),this.map=new Map(this.g,{p:this}),this.g.ents.push(this.dude),this.g.input.m.lastClick=!1,this.lastPress=!1,this._speed=200,this.speed=200,this.maxSpeed=400,this.gameOver=!1,this.fruits={cherry:this.g.draw.scale(this.g.imgs.cherry,3),melon:this.g.draw.scale(this.g.imgs.melon,3),orange:this.g.draw.scale(this.g.imgs.orange,3)}}},{key:"update",value:function(t){var e=this.ripples.length,s=!0,h=!1,a=void 0;try{for(var n,o=this.ripples[Symbol.iterator]();!(s=(n=o.next()).done);s=!0){var r=n.value;r.update(t)}}catch(l){h=!0,a=l}finally{try{!s&&o["return"]&&o["return"]()}finally{if(h)throw a}}for(;e--;)this.ripples[e].remove&&this.ripples.splice(e,1);if(_get(Object.getPrototypeOf(i.prototype),"update",this).call(this,t),this.map.update(t),this.dude.dead?this.speed=0:this.score+=.1,this.dude.dead&&!this.gameOver&&this.gameOverSequence(),this.gameOver||(this._speed+=.5,this.speed=~~this._speed,this.speed>this.maxSpeed&&(this.speed=this.maxSpeed)),3===this.dude.bonuses.length){var c=!!this.dude.bonuses.reduce(function(t,i){return t===i?t:NaN});c&&(this.dude.bonuses=[],this.dude.invincible=5,this.g.ents.push(new Text(this.g,{x:!1,y:this.g.h-200,text:"INVINCIBILTY",col:"r",vy:-200})),console.log("CCCCOMBO!",c))}this.score>this.hiScore&&(this.newHi||this.g.ents.push(new Text(this.g,{x:!1,y:this.g.h,text:"NEW HISCORE",col:"p",vy:-150,accel:5})),this.newHi=!0,this.hiScore=this.score)}},{key:"render",value:function(){var t=0;this.g.draw.clear($.cols.cloudblue);var e=!0,s=!1,h=void 0;try{for(var a,n=this.ripples[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){var o=a.value;o.render()}}catch(r){s=!0,h=r}finally{try{!e&&n["return"]&&n["return"]()}finally{if(s)throw h}}for(this.map.render(),_get(Object.getPrototypeOf(i.prototype),"render",this).call(this),this.dude.dead||this.dude.render(),this.g.draw.rect(0,0,this.g.w,35,$.cols.nightblue),this.g.ctx.globalAlpha=.3,this.g.draw.rect(0,0,this.g.w,40,$.cols.nightblue),this.g.ctx.globalAlpha=1,t=0;t<this.dude.bonuses.length;t+=1)this.g.ctx.drawImage(this.fruits[this.dude.bonuses[t]],120+40*t,5);this.g.draw.text(Math.floor(this.score),this.hi,10,10),this.g.draw.text(Math.floor(this.hiScore),this.hi_s,this.g.w-50,10),this.dude.invincible>0&&this.g.draw.text(Math.ceil(this.dude.invincible),this.timer,this.g.w/2-15,50),this.gameOver&&this.fader>0&&this.g.draw.text("GAME OVER",this.p,20,100,{f:this.pw,offset:4})}},{key:"gameOverSequence",value:function(){var t=this;this.gameOver=!0,this.newHi&&localStorage.setItem("hiScore",this.score),this.g.addEvent({time:.2,cb:function(){t.startButton=t.g.ents.push(new Button(t.g,{y:320,triggerOnEnter:!0,col:$.cols.newpoop,state:"Play",text:"RETRY",cb:function(){t.g.audio.play("tap"),t.g.changeState("Play")}})),t.quitButton=t.g.ents.push(new Button(t.g,{y:400,col:$.cols.skyblue,state:"Title",text:"TWEET",cb:function(){window.location="https://twitter.com/intent/tweet?&text=I+swam+"+~~t.score+"m+then+ate+poop,+playing+Poopy+River&via=eoinmcg&url=https%3A%2F%2Feoinmcg.github.io%2FPoopy"}}))}})}}]),i}(State),Dude=function(t){function i(t,e){_classCallCheck(this,i),e.col=$.cols.nightblue,e.group="player",e.baseScale=e.scale,e.speed=-200,e.jumping=!1,e.vx=0,e.vy=0,e.vz=0,e.z=0,e.i="dude",e.frames=2,e.scale=4;var s=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,t,e));return s.x=t.w/2-s.w/2,s.y=t.h-100,s.baseY=s.y,s.press=!1,s.lastPress=!1,s.sinceLastPress=0,s.gravity=1200,s.canJump=!0,s.jumping=!1,s.jump=-700,s.vy=0,s.nextRipple=0,s.rippleFreq=.1,s.o=e,s.angle=4.7,s.img=e.i,s.bonuses=[],s.shadow=t.draw.scale(s.g.imgs.shadow,s.scale),s.flipper=0,s.lastVx=s.vx,s.invincible=0,s}return _inherits(i,t),_createClass(i,[{key:"init",value:function(){this.anims={swim:{frames:[1,2],rate:100}},this.changeAnim("swim")}},{key:"updateMove",value:function(t){this.nextRipple+=t,this.invincible-=t,this.press=!!(this.g.input.m.click||this.g.input.keys.shoot||this.g.input.keys.enter),this.jumping||!this.press||this.lastPress||(this.canJump&&this.sinceLastPress<=5?(this.g.audio.play("jump"),this.vy=this.jump,this.jumping=!0):(this.g.emitter.particle($.H.rnd(1,3),this.x+this.w/2,this.y+this.h/2,["blind"]),this.g.audio.play("tap"),this.vx=0===this.vx?this.speed:this.vx*-1),this.sinceLastPress=0),this.angle+=this.vx/20,this.angle>5.3&&(this.angle=5.3),this.angle<4.1&&(this.angle=4.1),this.lastPress=this.press,(this.x<=0||this.x>=this.g.w-this.w)&&this.vx*-1,this.press||(this.sinceLastPress+=1);var i=this.vx;this.jumping&&(i=0),this.x+=i*t,this.y+=this.vy*t,this.vy+=this.gravity*t,this.jumping||(this.hitMap=this.p.map.checkEnt(this),this.mapCollision(this.hitMap[0],0,this.hitMap[2]),this.mapCollision(this.hitMap[1],1,this.hitMap[2])),this.y>this.baseY&&(this.y=this.baseY,this.jumping&&(this.g.audio.play("splash"),this.g.emitter.particle(10,this.x+this.w/2,this.y+this.h/2,["blind"]),this.g.ents.push(new Explosion(this.g,{x:this.x+20,y:this.y+10,p:this,track:1,vy:100,magnitude:18,white:!0,opacity:.5}))),this.jumping=!1,this.scale=4),this.jumping&&(this.scale=~~((this.baseY-this.y)/15),this.scale<this.o.scale&&(this.scale=this.o.scale)),this.x<0?this.x=0:this.x>this.g.w-this.w&&(this.x=this.g.w-this.w),!this.jumping&&!this.g.ios&&this.nextRipple>this.rippleFreq&&(this.nextRipple=0,this.p.ripples.push(new Ripple(this.g,{x:this.x+this.w/1,y:this.y+this.h/2,p:this.p}))),this.flipper=Math.sin(.02*(new Date).getTime()),this.lastVx=this.vx,this.jumping?this.mkImg("dudejump"):this.flipper>0?this.mkImg("dude0"):this.mkImg("dude1")}},{key:"render",value:function(){this.jumping&&(this.g.ctx.globalAlpha=.05,this.g.ctx.drawImage(this.shadow,this.x,this.baseY),this.g.ctx.globalAlpha=1);var t=_get(Object.getPrototypeOf(i.prototype),"rotate",this).call(this,this.invincible>0?this.iHurt:this.i,this.angle);this.g.ctx.drawImage(t,~~this.x,~~this.y)}},{key:"kill",value:function(t){this.jumping||(this.g.audio.play("die"),this.g.ents.push(new Explosion(this.g,{i:"ouch",x:this.x,y:this.baseY})),this.g.shake.start(50,30),this.g.emitter.particle(40,this.x,this.baseY,["oldpoop","newpoop"]),_get(Object.getPrototypeOf(i.prototype),"kill",this).call(this))}},{key:"mapCollision",value:function(t,i,e){var s=!1,h=void 0;switch(e[0]=e[0]+i,t){case 1:case 2:this.x+=0===i?this.scale:-this.scale,this.vx*=-1,this.g.audio.play("tap");break;case 3:this.invincible<0?this.kill():(this.g.emitter.particle(40,this.x+20,this.baseY,["oldpoop","newpoop"]),this.g.audio.play("zap")),s=!0;break;case 4:s=!0;break;case 5:s=!0;break;case 6:s=!0}s&&(4==t?h="cherry":5==t?h="orange":6==t&&(h="melon"),3===t||(this.bonuses.push(h),this.bonuses.length>3&&this.bonuses.shift(),this.g.audio.play("coin"),this.g.ents.push(new Text(this.g,{x:this.x,y:this.baseY,i:h,vx:100,accel:10}))),this.p.map.data[this.p.map.data.length-e[1]][e[0]]=0)}},{key:"receiveDamage",value:function(t){}}]),i}(Sprite),Ripple=function(t){function i(t,e){_classCallCheck(this,i);return e.i="ripple",e.scale=2,e.opacity=.7,e.vy=100,_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,t,e))}return _inherits(i,t),_createClass(i,[{key:"update",value:function(t){this.scale+=.2,this.y+=this.p.speed*t,this.mkImg("ripple"),this.opacity-=.02,this.opacity<0&&this.kill()}},{key:"render",value:function(){this.g.ctx.globalAlpha=this.opacity,this.g.ctx.drawImage(this.iHurt,this.x-this.w/2,this.y-this.h/2),this.g.ctx.globalAlpha=1}}]),i}(Sprite),Text=function(t){function i(t,e){_classCallCheck(this,i),e.group="text",e.vy=e.vy||-300,e.w=10,e.w=10,e.o=1,e.scale=e.scale||4,e.col=e.col||"w",e.accel=e.accel||0;var s=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,t,e));return s.p=t.mkFont(e.col,e.scale),s}return _inherits(i,t),_createClass(i,[{key:"update",value:function(t){this.y<0&&this.kill(),this.vy-=this.accel,this.x+=this.vx*t,this.y+=this.vy*t}},{key:"render",value:function(){this.text?this.g.draw.text(this.text,this.p,this.x,this.y):this.o&&this.g.ctx.drawImage(this.i,this.x,this.y)}}]),i}(Sprite),Explosion=function(t){function i(t,e){_classCallCheck(this,i);e.i=e.i||"boom",e.white=e.white||!1;var s=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,t,e));return s.name="explosion",s.group="na",s.startX=e.x,s.startY=e.y,
s.magnitude=e.magnitude||16,s.factor=1,s.p=e.p||!1,s.angle=0,s.grow=1,s.opacity=e.opacity||1,s}return _inherits(i,t),_createClass(i,[{key:"update",value:function(t){this.g;this.scale<=this.magnitude&&(this.scale+=this.factor),this.scale===this.magnitude&&(this.factor*=-1),this.scale<=1&&(this.remove=!0),this.mkImg(this.o.i)}},{key:"render",value:function(){var t=this.startX-this.w/2,i=this.y-this.h/2,e=this.g,s=this.white?this.iHurt:this.i;this.opacity<1&&(e.ctx.globalAlpha=this.opacity),e.ctx.drawImage(s,t,i),this.opacity<1&&(e.ctx.globalAlpha=1)}}]),i}(Sprite);